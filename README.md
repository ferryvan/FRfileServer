# 可登录的文件传输程序
一个可登录的文件传输程序，使用python实现，仿照实现了一部分ftp命令。

# 系统概述
### 运行环境
    python>=3.7
    mongodb数据库
    python pymongo库
    python struct库

### 编译
    解释运行：
    python -u ./server.py
    python -u ./client.py

### 使用方法
    先运行server再运行client
    client可运行多次形成多客户端

### 实现环境
    python 3.7

### 程序文件列表
    server.py       --服务端
    client.py       --客户端

### 主要数据结构
    python socket类

# 主要算法描述
### 多线程
        多线程技术，主线程在不断的阻塞等待新客户端的接入，在主线程中有一个socket不断轮询等待客户端的连接，每次accept()接收到用户连接都将新的socket扔进一个新线程中去，这样每个线程对应一个用户。

### 防粘包发送接收
        接收方不及时接收缓冲区的包，造成多个包接收，客户端发送了一段数据，服务端只收了一小部分，服务端下次再收的时候还是从缓冲区拿上次遗留的数据，从而产生粘包现象。
        我们是采用的对所有短指令使用了先计算长度然后按整型变量的字节数4打包发送长度信息，接收方取出长度之后，固定长度接收，这样就可以解决粘包问题。
        我们使用这一对防粘包发送和接收的函数来发送所有的短指令，这样就做到了发送端和接收端的统一。

### 文件发送接收
        对于文件传输，我们使用了先发送报头的形式，沿用刚才的思路，先使用防粘包的函数发送文件长度和文件名，然后再使用普通socket发送文件。
        需要注意的一点是文件长度会非常长，所以有一个循环，每次接受1024个字节，直到最后一个包，这个包的接收长度=（文件长度%1024）

### 登录注册
        登录注册标志登录状态的是在本线程中的一个局部变量usernow，当这个变量为空字符串时为未登录，而登录之后置为用户名
        我们通过对用户名和密码进行哈希之后存入数据库来确保密码在服务端的安全性，这样服务器数据库不会存储明文密码，即使数据库被脱库也不会造成用户隐私数据的丢失。
        每次登陆的时候服务器都做一次哈希操作然后与数据库中的内容进行对比，对比成功则置位usernow登陆成功。否则失败。

# 用户使用手册
        指令

        登录       login 用户名 密码
                或  login  后按提示输入(带密码保护，推荐)
        注册       register 用户名 密码
                或  register  后按提示输入(带密码保护，推荐)

        注销      logout   (不会断开与服务器的连接)
        退出      bye      (断开与服务器的连接并退出程序)


        文件列表   dir    (列出服务器的所有文件)
        删除文件   del 文件1 文件2 ... 文件N
                        （删除文件1到文件N)

        下载      get 文件名    (不支持绝对路径)
        上传      put 文件名    (不支持绝对路径)

        帮助      help
    
# 程序源代码
见附件

